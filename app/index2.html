<!doctype html>
<html lang="en">
  <head>
    <title>Ninjava tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.2">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" href="css/bootstrap4.min.css">
	<link rel="stylesheet" href="css/custom.css">
	<script src="js/jquery-3.4.1.slim.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="js/bootstrap4.min.js"></script>
	<link href="css/bootstrap-toggle.min.css" rel="stylesheet">
	<script src="js/bootstrap-toggle.min.js"></script>
	<link href= "css/fontawesome.min.css" rel="stylesheet">
	<script>


	var DataPackageToBeSent = "";
	var DataPackageLenght = "";
	
	var UDPtestTimer;
	// get the system clipboard
	var clipboard = nw.Clipboard.get();
	var si;
	var fs = require('fs');
	var path = './app';
	var device_path = 'a:/';
	var device_family = '';
	var reloadWatcher=fs.watch(path, function() {
			console.log("reloading...");
			serialPort.close(); 
			MonitorPort.close();
			setTimeout( window.location.reload() ,100);
			setTimeout( location.reload() ,200);
			reloadWatcher.close();
		});
	var audio = new Audio('sound/Distorted_Message2.wav');
	//audio.volume(.5);
	
	var path = require('path');
	var nwPath = process.execPath;
	var nwDir = path.dirname(nwPath);
	
	var SerialPort = require("browser-serialport");
	var	serialPort = new SerialPort.SerialPort('COM', { baudrate: 115200 }, false);
	var	MonitorPort= new SerialPort.SerialPort('COM', { baudrate: 115200 }, false);
	
	var last_cmd = "";
	var	last_response = "";
	var	last_response_buf = "";
	var local_file_contents;
	var runninigMidletsList = new Array;
	var installedMidletsList = [];
	const CHUNK_SIZE = 1500;
	var	timeout,t0,t1;
	var FinishDownload;
	var IgnoreNextAtError = false;
	
	if (typeof localStorage.lastPort 		=== 'undefined' ) localStorage.lastPort = "";
	if (typeof localStorage.lastMonitorPort === 'undefined' ) localStorage.lastMonitorPort = 'None';
	if (typeof localStorage.lastLogging 	=== 'undefined' ) localStorage.lastLogging = false;
	if (typeof localStorage.lastLogFile 	=== 'undefined' ) localStorage.lastLogFile = '';

	const ATDEBUG = false;
		
	
	function log2file(data)
	{
		if ($('#toggle-Logging').prop('checked')) 
		{
			var timestamp = new Date();
			fs.appendFileSync( localStorage.lastLogFile, "\n" + timestamp.toLocaleString() + "  " + data, 'utf8');
		}
	}
	
	function delay(t) {
	   return new Promise(function(resolve) { 
		   setTimeout(resolve, t)
	   });
	}

	function SerialSend(cmd,ignore_error) {
		if (cmd !== undefined)		// First call
		{
			$('#MainPortDropdownButton').addClass("blink");
			last_response = "";
			last_response_buf = "";
			if ( ATDEBUG ) console.log("Sending "+cmd);

			var textForTerminal = cmd.length < 100 ? cmd.slice(0, -1) : cmd.slice(0,50) + "...";
			document.getElementById("pre1").innerHTML += '<span>' + textForTerminal + '</span>';
			document.getElementById("terminal1").scrollTop = document.getElementById("terminal1").scrollHeight;	 
			
			if (ignore_error) IgnoreNextAtError = true;
			last_cmd = cmd;
			serialPort.drain();
			delay(100).then( ()=> {
				console.log("Serial >"+cmd);
				serialPort.write(cmd);
				log2file(">  " + cmd)
				
			});
			//console.log("Start waiting for response");
			timeout = 2000;
		}

		return new Promise(function (resolve, reject) {
			(function waitForResponse() {
				if (last_response != "") 
				{
					$('#MainPortDropdownButton').removeClass("blink");
					if ( ATDEBUG ) console.log("modem response:", last_response);
					
					document.getElementById("pre1").innerHTML += last_response;
					

					document.getElementById("terminal1").scrollTop = document.getElementById("terminal1").scrollHeight;

					//var temp = last_response;
					return resolve(last_response);
				}
			if ( !timeout-- ) 
			{
				alert("ERROR: Timeout waiting for modem response!");
				SerialOpen();
				//reject("Timeout waiting for modem response");
			}
			else setTimeout(waitForResponse, 50);
		})();
		});
	}

	var last_port = "";
	
	function ChangeDeviceDir(path)
	{
		return new Promise(function(resolve, reject) {
		document.getElementById("contents").value = "";

		device_path = path.replace(/\/$/g,"");
		if (device_path == "a:") device_path = "a:/";
		device_path = device_path.replace(/\/\//g,"/");

		console.log("Change Device Dir " + device_path);
		
		$('.fe_btn').hide();

		var breadcrumblist = document.getElementById("breadcrumb");
		while (breadcrumblist.firstChild) {
			breadcrumblist.removeChild(breadcrumblist.firstChild);
		}
 
		
		
		list = device_path.split("/")
		//console.log("list="+list);
		
		index = 0;
		tpath = "";
		while (index < list.length) { 
			//console.log("tpath="+tpath);
			folder = document.createElement('li');
			folder.classList.add("breadcrumb-item");
			folder.innerHTML = '<a href="javascript:ChangeDeviceDir(\'' + tpath + list[index] + '/\')">' + list[index] + '</a>';
			tpath += list[index] + "/";
			breadcrumblist.appendChild(folder);
			index++; 
		}

		SerialSend('AT^SFSA="stat","' + device_path + '' + '"\r', true)
		.then((statresult)=>{

	
			console.log("statresult="+statresult);
			index = 0; 

			var filelist = document.getElementById("filelist");
			while (filelist.firstChild) {
				filelist.removeChild(filelist.firstChild);
			}

			var folder = false;
			var filesize = statresult.split("\n")[1].match(/\d+/g)
			//console.log("lines =" + statresult.split("\n"));
			//debugger;
			if (["EXS","TX"].includes( device_family ) && statresult.split("\n")[5].includes("16")) { folder = true; }
			if (["PLS","ELS"].includes( device_family ) && (statresult.split("\n")[3].includes("16") || statresult.split("\n")[3].includes("18"))) { folder = true; }
			//debugger;
			if  (folder) // Folder
			{

				/*if (device_family == 'EXS') {
					filec = document.createElement('li');
					filec.classList.add("list-group-item");
					filec.innerHTML = '<a href="javascript:ChangeDeviceDir(\'' + device_path + '/../\')">..</a>';
					filelist.appendChild(filec);
				}*/
		
				$('#fe_create').show();
				$('#fe_upload').show();
				if (device_path != "a:/") $('#fe_rmdir').show();
				
				SerialSend('AT^SFSA="ls","' + device_path + '"\r', true)
				.then((lsresult)=>{
				
					list = lsresult.split("\r\n")				
					
					while (index < list.length) { 
						match = list[index].match(/^\^SFSA: "?((\w|\.|\-)+)"?/)
						//console.log("line=" + list[index] + " m:" + match)

						index++; 
						if (match)
						{
							if (match[1] == "0") continue;
							filec = document.createElement('li');
							filec.classList.add("list-group-item");
							filec.innerHTML = '<a href="javascript:ChangeDeviceDir(\'' + device_path + '/' + match[1] + '/\')">' + match[1] + '</a>';
							filelist.appendChild(filec);
					
						}
					}

					resolve();

				})
			}
			
			else // File
			
			{
				$('#fe_rmfile').show();

				if (device_path.endsWith(".bin") && ["EXS","TX"].includes(device_family) )
				{
					$('#fe_run').show();
					$('#fe_stop').show();
					document.getElementById("contents").value = "\n\n         This is a binary file";
				}
				else
				{
					// This is a file, try to read it
					if (device_family == 'EXS') read_flag  = '2'
					else read_flag = '8';
					
					SerialSend('AT^SFSA="open","' + device_path + '",' + read_flag + '\r', true)
					.then((opresult)=>{
						match = opresult.match(/(\d+), ?0/m);
						if (match)
						{
							fh = match[1];
							document.getElementById("contents").value = "";
							SerialSend('AT^SFSA="read",' + fh + ',' + filesize + '\r', true)
							.then((reresult)=>{
								list = reresult.split("\r\n")
								console.log("file contents:" + list);
								for (i=2;i<list.length-2;i++)
								{
									document.getElementById("contents").value += list[i] + '\r\n';
									//console.log("line="+list[i]);								
								}
								SerialSend('AT^SFSA="close",' + fh + '\r', true).then ( ()=> resolve() );
							})
						}
					})
				}
			}
		})
		
	});
	}
	

	function SetMonitorPort(port)
	{
		//console.log("SetMonitorPort:" + port);
		if(MonitorPort.isOpen()) {
			console.log("Closing open monitor port");
			MonitorPort.close();
		}

		if (port == 'None') {
			$('#terminal2').hide();
			localStorage.lastMonitorPort = port;
			document.getElementById("MPORTDropdownButton").innerHTML = 'None<span class="caret"></span>';
		}
		else  {
			
			MonitorPort = new SerialPort.SerialPort(port, { baudrate: 115200 }, false);
			MonitorPort.open(function (error) {
				if ( error ) {
					console.log(error.message);
				} else {
					console.log('Monitor port ' + port + ' opened successfully !');
					localStorage.lastMonitorPort = port;
					document.getElementById("MPORTDropdownButton").innerHTML = port.replace(/\\/g, '').replace(/\./g, '') + ' <span class="caret"></span>';
					$('#terminal2').show();
					MonitorPort.on('data', function(data) {
						document.getElementById("pre2").innerHTML += data; 
					});
				}
			});
		}
	}
	
	function SerialOpen(port)
	{
		if (port === undefined) port = last_port;
		last_port = port;
		if(serialPort.isOpen()) 
		{
			console.log("Closing open port");
			serialPort.close();
			if (typeof UDPtestTimer !== 'undefined') clearTimout(UDPtestTimer);
		}
		
		//console.log("Opening " + port);
		serialPort = new SerialPort.SerialPort(port, { baudrate: 115200 }, false);
		
		serialPort.open(function (error) {
		  if ( error ) {
			console.log(error.message);
		  } else {
			console.log("Main port " + port + ' opened successfully !');
			localStorage.lastPort = port;
			document.getElementById("MainPortDropdownButton").innerHTML = port.replace(/\\/g, '').replace(/\./g, '') + ' <span class="caret"></span>';
			document.getElementById("MainPortDropdownButton").setAttribute('class', 'btn btn-default btn-xs dropdown-toggle btn-success');
			document.getElementById("closeBtn").style.visibility = 'visible';
			document.getElementById("accordion").style.visibility = 'visible';

			serialPort.drain();
			serialPort.on('data', function ProcessResponse(data) {
			
				//console.timeEnd("Since last response"); 
				//console.time("ProcessResponse"); 
				last_response_buf += data.toString() ;
				console.log("Serial < ",data.toString());
				log2file("<  " + data.toString());
				
				if (last_response_buf.includes("CONNECT") || last_response_buf.includes("CARRIER") || last_response_buf.includes("\r\nOK") || last_response_buf.includes("ERROR") || last_response_buf.includes("\r\n>") || last_response_buf.includes("\r\n^SUSRW") || last_response_buf.includes("\r\n^SISW: "))
				{
					//console.log("Serial < ",last_response_buf);
					
					//document.getElementById("pre1").innerHTML += last_response;
					//document.getElementById("terminal1").scrollTop = document.getElementById("terminal1").scrollHeight;

					last_response = last_response_buf;
					
					if (last_response_buf.includes("ERROR")) {
						if ( ATDEBUG ) console.log("modem response:",last_response)
						if (!IgnoreNextAtError) alert(last_response);
						IgnoreNextAtError = false;
					}
				}
				//console.time("Since last response");
				//console.timeEnd("ProcessResponse");
			});
			
			SerialSend("AT+CMEE=2;E0\r")  // verbose ERROR + no Echo 
				.then(()=>{			
				SerialSend("ati1\r")		// check firmware version
					.then((result)=>{
						//console.log(result);
						match = result.match(/(ENS|EXS|TX|EHS|ELS|PLS)/);
						device_family = match[1];
						//console.log(match[1]);

						//document.getElementById("ati1").innerHTML = result.slice(2).replace(/\r/g,"").replace("\n\nOK\n","").replace(/\n/g,"<br>");
						temp = result.slice(2).replace(/\r/g,"").replace("\n\nOK\n","").split("\n")
						document.getElementById("ati1").innerHTML = temp[1];
						document.getElementById("ati2").innerHTML = temp[2] + ' ' + temp[3];
						
						if ("ENS" == device_family) $('#FileExplorerCard').hide();
						if ("ELS" != device_family) $('#ATT3Gsunset').hide();
						
						if ( ["ENS","EXS","TX"].includes(device_family) ) 
						{
							$('#CardManage').hide();
							$('#CardSTDOUT').hide();
							$('#CardUpload').hide();
							
						}
						else
						{
							$('#CardLPM').hide();
						}
						
						
					})
				})
		  }
		});
	}
	
	function SerialClose()
	{
		document.getElementById("MainPortDropdownButton").innerHTML = 'COM port';
		document.getElementById("MainPortDropdownButton").setAttribute('class', 'btn btn-secondary btn-xs dropdown-toggle');
		document.getElementById("ati1").innerHTML = "";
		document.getElementById("ati2").innerHTML = "no modem";
		document.getElementById("closeBtn").style.visibility = 'hidden';   
		document.getElementById("accordion").style.visibility = 'hidden'; 
		clearTimeout(UDPtestTimer);
		localStorage.lastPort = "";
		serialPort.close();
		}

	function RefreshMidletStates()
	{
		if (!$('#collapseManage').hasClass('show')) return;
		
		return new Promise(function(resolve, reject) {
		
		SerialSend("AT^SJAM=5\r", true)
		.then( (response)=> {
			 lines = response.split("\n");
			 runninigMidletsList = [];
			 for (var i = 0; i < lines.length; i++) {
				if (lines[i].startsWith("^SJAM:"))
				{
					var midletName = lines[i].replace("^SJAM: ","").replace("a:\/","").replace(/\"/g,"").split(",")[0];
					//console.log("ra:" +midletName);
					runninigMidletsList.push(midletName);
				}
			}
			
			SerialSend("AT^SJAM=4\r", true)
			.then( (response)=> {
				lines = response.split("\n");
				installedMidletsList = [];
				
				var midletList = document.getElementById("midletsList");
				while (midletsList.firstChild) {
					midletsList.removeChild(midletList.firstChild);
				}
				
				for (var i = 0; i < lines.length; i++) {
					if (lines[i].startsWith("^SJAM:"))
					{
						var midletName = lines[i].replace("^SJAM: ","").replace("a:\/","").replace(/\"/g,"").split(",")[0];
						installedMidletsList.push(midletName)
						tr = document.createElement('tr');
						td1 = document.createElement('td');
						td1.innerHTML = '<h6><small>' + midletName;
						tr.appendChild(td1);
						
						td2 = document.createElement('td');
						td2.innerHTML = '<h6><small>' + lines[i].replace("^SJAM: ","").replace(/\"/g,"").split(",")[2];
						tr.appendChild(td2);

						td3 = document.createElement('td');
						td3.innerHTML = '<h6><small>' + lines[i].replace("^SJAM: ","").replace(/\"/g,"").split(",")[3];
						tr.appendChild(td3);

						td4 = document.createElement('td');
						td4.innerHTML = '<h6><small>' + lines[i].replace("^SJAM: ","").replace(/\"/g,"").split(",")[5];
						tr.appendChild(td4);

						td5 = document.createElement('td');
						checked = (runninigMidletsList.indexOf(midletName) > -1) ? 'checked' : '';
						//console.log('checked=' + checked);
						td5.innerHTML = '<input id="toggle' + i + '" data-size="mini" type="checkbox" class="btn-sm" ' + checked 
						+ ' data-toggle="toggle" data-midlet="' + midletName + '" data-size="small"  data-on="Run " data-off="Stop ">';
						tr.appendChild(td5);

						td6 = document.createElement('td');
						td6.innerHTML += '<a id="trash' + i + '" ' + (checked ? ' hidden' : '') + ' data-midlet="' + midletName + '" href="#"><i class=\'fa fa-trash\'></i></a>';
						tr.appendChild(td6);

						midletsList.appendChild(tr)
						$('#toggle'+i).bootstrapToggle();
						
						$('#toggle' + i).change(function() {
						  document.getElementById("trash" + $(this).prop('id').slice(-1)).style.visibility = 'hidden';
						  //console.log('Toggle: ' + midletName + " " + $(this).prop('checked'));
						  SerialSend("AT^SJAM=" + (($(this).prop('checked')) ? '1' : '2') + 
									",\"a:/" + $(this).attr('data-midlet') + "\",\"\"\r", true)
						  .then ( ()=>{
							delay(100).then ( ()=> {
								RefreshMidletStates();
							})
						  })
						})

						$('#trash' + i).click(function() {
						  SerialSend("AT^SJAM=3,\"a:/" + $(this).attr('data-midlet') + "\",\"\"\r", true)
						  .then ( (result)=>{
							RefreshMidletStates();
						  })
						})
					}
				}
				//RefreshPanels();
				resolve();
			}
			
			);
		});
			
		});	
	}
	
	function UploadFileSJDL(file)
	{
		t0 = performance.now();
		local_file_contents = fs.readFileSync(file);
		fsize = fs.statSync(file).size;
		
		return new Promise(function (resolve, reject) {
			File = file.replace(/.*\\/, '');
			console.log("Opening " + File + " for writing");
			
			SerialSend('AT^SJDL=1,' + fsize +  ',"' + File + '"\r')
			.then( (result) => {
				
				if (result.includes("CONNECT")) // opened successfully
				{
					//SerialSend(local_file_contents)
					SerialSend(local_file_contents)
					.then(()=>{ 
						t1 = performance.now();
						console.log("Finished writing file in ", t1-t0, "ms");
						resolve(); 
						
					})
				}
			})			
		});

	}
	
	function UploadFile(file)
	{
		t0 = performance.now();
		return new Promise(function (resolve, reject) {
		    FinishDownload = resolve; 

			jadFile = file.replace(/.*\\/, '');
			console.log("Opening " + jadFile + " for writing");
			
			//SerialSend('AT^SFSA="open","a:/test.bin",10\r')
			SerialSend('AT^SFSA="open","a:/' + jadFile + '",10\r')
			.then( (result) => {
				
				if (result.includes(",0")) // opened successfully
				{
					fh = result.match(/(\d+),/)[1];
					console.log("fh=" + fh);
					fsize = fs.statSync(file).size;
					//fsize = 100;
					//console.log("fsize=" + fsize);
					
					local_file_contents = fs.readFileSync(file);
					
					console.log("sizes=", fsize, local_file_contents.length);
					
					WriteToFileHandler(fh,local_file_contents.length);
				}
			})			
		});
	}
	
	function WriteToFileHandler (fh, length)
	{
		console.log("WriteToFileHandler ",fh,length)
		if (length > CHUNK_SIZE)
		{
			SerialSend('AT^SFSA="write",' + fh + ',' + CHUNK_SIZE + '\r')
			.then( (result)=> {
				if (result.includes("CONNECT"))
				{
					//console.log('cont1=',local_file_contents);
					//console.log('cont2=',local_file_contents[0,);
					SerialSend(local_file_contents.slice(0,CHUNK_SIZE))
					.then( (result)=> {				
						local_file_contents = local_file_contents.slice(CHUNK_SIZE,local_file_contents.length);
						WriteToFileHandler(fh,length - CHUNK_SIZE);
					})
				}
			});
		}
		else {
			SerialSend('AT^SFSA="write",' + fh + ',' + length + '\r')
			.then( (result)=> {
				if (result.includes("CONNECT"))
				{
					SerialSend(local_file_contents)
					.then( (result)=> {				
						SerialSend('AT^SFSA="close",' + fh + '\r')
						.then(()=>{
							t1 = performance.now();
							console.log("Finished writing file in ", t1-t0, "ms");
							FinishDownload();
						})
					})
				}
			});
		}
	}

	$(document).ready(function(){
		$('#MainPortDropdown').on('show.bs.dropdown', function(){
			$('#MainPortDropdownMenu > a').remove();
			SerialPort.list(function (err, ports) {
				ports.forEach(function(port) {
					$("#MainPortDropdownMenu").append('<a class="dropdown-item" href="javascript:SerialOpen(\'' + port.comName.replace(/\\/g, "\\\\") + '\');">' + port.comName.replace(/\\/g, '').replace(/\./g, '') + '</a>');
					//console.log(port.comName,port.pnpId,port.manufacturer);
				});
			});
		});
		

		$('#MPORTDropdown').on('show.bs.dropdown', function(){
			$('#MPORTDropdownMenu > a').remove();
			$("#MPORTDropdownMenu").append('<a class="dropdown-item" href="javascript:SetMonitorPort(\'None\');">None</a>');
			SerialPort.list(function (err, ports) {
			console.log("!!!!!");
				ports.forEach(function(port) {
					//console.log(port.comName,port.pnpId,port.manufacturer);
					//if (port.manufacturer.includes('Port')) {
						$("#MPORTDropdownMenu").append('<a class="dropdown-item" href="javascript:SetMonitorPort(\'' + port.comName.replace(/\\/g, "\\\\") + '\');">' + port.comName.replace(/\\/g, '').replace(/\./g, '') + " USB" + port.manufacturer.slice(-1) + '</a>');
						//console.log(port.comName,port.pnpId,port.manufacturer);
					//}
				});
			});
		});
		
		SetMonitorPort(localStorage.lastMonitorPort)

      });
	
$(function() {

	document.getElementById('logfilelable').innerHTML = localStorage.lastLogFile;

  window.addEventListener('keydown', function (e) {

	if (document.activeElement != document.body) return;
	if (document.getElementById("collapseTerminal").classList.contains('collapsed')) return;
	if (serialPort.connectionId == -1) return;
    if ([16,17,18,20,37,38,39,40].includes(e.keyCode)) return; // ignore
	
	
	var code = e.keyCode;
	
	if (e.keyCode >= 65  && e.keyCode <= 90) code = e.shiftKey ? e.keyCode : e.keyCode + 32;

	if (e.keyCode == 222 && !e.shiftKey) code = 39; //'
	if (e.keyCode == 222 && e.shiftKey)  code = 34; //"

	if (e.keyCode == 49  && e.shiftKey)  code = 33; //!
	if (e.keyCode == 50  && e.shiftKey)  code = 64; //@
	if (e.keyCode == 51  && e.shiftKey)  code = 35; //#
	if (e.keyCode == 52  && e.shiftKey)  code = 36; //$
	if (e.keyCode == 53  && e.shiftKey)  code = 37; //%
	if (e.keyCode == 54  && e.shiftKey)  code = 94; //^
	if (e.keyCode == 55  && e.shiftKey)  code = 38; //&
	if (e.keyCode == 56  && e.shiftKey)  code = 42; //*
	if (e.keyCode == 57  && e.shiftKey)  code = 40; //(
	if (e.keyCode == 48  && e.shiftKey)  code = 41; //)
	if (e.keyCode == 189 && !e.shiftKey) code = 45; //-
	if (e.keyCode == 189 && e.shiftKey)  code = 95; //_
	if (e.keyCode == 187 && !e.shiftKey) code = 61; //=
	if (e.keyCode == 187 && e.shiftKey)  code = 43; //+
	if (e.keyCode == 186 && e.shiftKey)  code = 58; //:
	
	if (e.keyCode == 190 && !e.shiftKey) code = 46; //.
	if (e.keyCode == 190 && e.shiftKey)  code = 62; //>

	if (e.keyCode == 191 && !e.shiftKey) code = 47; ///
	if (e.keyCode == 191 && e.shiftKey)  code = 63; //>

	if (e.keyCode == 188 && !e.shiftKey) code = 44; //,
	if (e.keyCode == 188 && e.shiftKey)  code = 60; //<
	
	if (e.keyCode == 220 && !e.shiftKey) code = 92; //\
	if (e.keyCode == 220 && e.shiftKey)  code = 124; //|
	
	
	console.log(code, String.fromCharCode(code));
	
	
	

	if ((code == 99) && e.ctrlKey)
	{
		var text = window.getSelection().toString();
		clipboard.set(text, 'text');
		console.log('Copied to clipboard - ' + text)
		return;
	}
	
	if  ((code == 118) && e.ctrlKey)
	{
		// Read from clipboard
		var text = clipboard.get('text');
		//console.log('paste=' + text);
		serialPort.write(text);
		
		for (var i = 0; i < text.length; i++) {
		  document.getElementById("pre1").innerHTML += '<span>' + text.charAt(i) + '</span>';
		}
		
		return;
	}
	else
		serialPort.write(String.fromCharCode(code));
	
	
	if (e.keyCode == 13) { 
		e.preventDefault();
		SerialSend("") 
	}
	else 
		if (e.keyCode == 8 ) // backspace
			document.getElementById("pre1").innerHTML = document.getElementById("pre1").innerHTML.slice(0,-14);
		else document.getElementById("pre1").innerHTML += '<span>' + String.fromCharCode(code) + '</span>';
		
	//document.getElementById("terminal1").scrollTop = document.getElementById("terminal1").scrollHeight;

});

  $('#inputGroupFile01').on('change', function(e) {
	$('#inputGroupFile01')[0].labels[0].innerHTML = $('#inputGroupFile01')[0].value.replace(/\\/g, '/').replace(/.*\//, '');
	});

  $('#FileInput').on('change', function(e) {

	var input = $(this);
	var FullPath = input.val();
	
			var OverwriteWatcher=fs.watch(FullPath, function() {
				if (document.getElementById("watchcb").checked)
				{
					setTimeout( function () { Upload(FullPath); }, 2000);
				}
			});

			Upload(FullPath)
  });
  
});

function UploadBin(file)
{
	console.log("uploading bin file:" + file);

	local_file_contents = fs.readFileSync(file);
	fsize = fs.statSync(file).size;
	t0 = performance.now();
	return new Promise(function (resolve, reject) {
		File = file.replace(/.*\\/, '');
		console.log("Removing old file " + File);
		SerialSend('AT^SFSA="remove","' + (device_path + '/').replace(/\/\//g,"/") + File + '"\r', true)
		.then( () => {
		
			console.log("Opening " + File + " for writing");
			if (["PLS"].includes( device_family )) write_flag = "8"
			else  write_flag = "9"
			SerialSend('AT^SFSA="open","' + (device_path + '/').replace(/\/\//g,"/") + File + '",' + write_flag + '\r', true)
			.then( (opresult) => {
						
				match = opresult.match(/(\d+), ?0/m);
				if (match)
				{
					fh = match[1];
					SerialSend('AT^SFSA="write",' + fh + ',' + fsize + '\r')
					.then ( (result) => {
					
						if (result.includes("CONNECT")) // opened successfully
						{
							SerialSend(local_file_contents)
							.then(()=>{ 
								SerialSend('AT^SFSA="close",' + fh + '\r')
								.then( () => {
									t1 = performance.now();
									console.log("Finished writing file in ", t1-t0, "ms");
									//ChangeDeviceDir(device_path);
									$('#UploadFileModal').modal('hide');
									resolve(); 
								});
							});
						}
					
					
					})
				}
			});
		});			
	});

}

function Upload(file)
{
	console.log("here!");
	return new Promise(function (resolve, reject) {

	label = file.replace(/\\/g, '/').replace(/.*\//, '');
	document.getElementById('jadFile').innerHTML = label;
	document.getElementById('FileInput').value = "";
	if (label.substring(label.length-4) == ".jad") document.getElementById("step1").style.visibility = "visible";
	UploadFileSJDL(file).then(()=>{
		document.getElementById("step1").style.visibility = "hidden";
		if ((label.substring(label.length-4) == ".jad") && document.getElementById("step2cb").checked ) {
			document.getElementById("step2").style.visibility = "visible";
			UploadFileSJDL(file.substring(0,file.length-4)+".jar")
			.then(()=>{
				document.getElementById("step2").style.visibility = "hidden";
				if (document.getElementById("step3cb").checked) {	// Stop midlet
					document.getElementById("step3").style.visibility = "visible";
					SerialSend('AT^SJAM=2,"a:/' + label + '",""\r',true) // Ignore error
					.then(()=>{
					document.getElementById("step3").style.visibility = "hidden";
					if (document.getElementById("step4cb").checked) {	// Install midlet
						document.getElementById("step4").style.visibility = "visible";
						SerialSend('AT^SJAM=0,"a:/' + label + '",""\r')
						.then(()=>{
						document.getElementById("step4").style.visibility = "hidden";
						if (document.getElementById("step5cb").checked) {	// Run midlet
							document.getElementById("step5").style.visibility = "visible";
							SerialSend('AT^SJAM=1,"a:/' + label + '",""\r')
							.then(()=>{
								document.getElementById("step5").style.visibility = "hidden";
								if (document.getElementById("step6cb").checked) {
									document.getElementById("step6").style.visibility = "visible";
									audio.play();
									setTimeout( function () {document.getElementById("step6").style.visibility = "hidden";}, 300);
								}
							})
						}
						})
					}
					})
				}
			}) 
		}
	})
	resolve();
});
}
    
function NetworkRefresh() {
	if (!$('#collapseNetwork').hasClass('show')) return;
		SerialSend('AT+CPIN?\r', true).then ( (result)=> { 
			document.getElementById("CPIN").value = result.split("\n")[1].replace('+CPIN:','');
			SerialSend('AT+CIMI\r', true).then ( (result)=> { 
				document.getElementById("CIMI").value = result.split("\n")[1];
					SerialSend('AT+CGSN\r', true).then ( (result)=> { 
					document.getElementById("CGSN").value = result.split("\n")[1];
						SerialSend('AT+CEREG?\r', true).then ( (result)=> { 
						document.getElementById("CEREG").value = result.split("\n")[1].replace('+CEREG:','');
							SerialSend('AT^SMONI\r').then( (result)=> {
							document.getElementById("SMONI").value = result.slice(10,-6)
								SerialSend('AT+COPS?\r',true).then ( (result)=> { 
								if (result.includes("ERROR"))
									{document.getElementById("COPS").value = result;}
								else
									{document.getElementById("COPS").value = result.slice(9,-6); }
									
									SerialSend('AT+CGPADDR\r',true).then( (result)=> {
									document.getElementById("CGPADDR").value = result.split("\n")[1].replace('+CGPADDR:','');
									
										SerialSend('AT+CPSMS?\r',true).then( (result)=> {
										document.getElementById("CPSMS").value = result.split("\n")[1].replace('+CPSMS:','');
										
											SerialSend('AT+CEDRXRDP\r',true).then( (result)=> {
											document.getElementById("CEDRXRDP").value = result.split("\n")[1].replace('+CEDRXRDP:','');
										
									
									
												SerialSend('AT+CGDCONT?\r',true).then ( (result)=> { 
												document.getElementById("CGDCONT").innerHTML = result.slice(2,-6);
													SerialSend('AT^SCFG?\r',true).then ( (result)=> { 
													document.getElementById("SCFG").innerHTML = result.slice(2,-6);
											})
										})
									})
								})
							})
						})
					})
				})
			})
		})
	})  
}
	
function SetSTDOUT(interf)
{
	SerialSend('AT^SCFG="Userware/Stdout","' + interf + '"\r').then( (result)=> {
	if (result.includes("OK"))
		document.getElementById("STDOUTDropdownButton").innerHTML = interf;
	})
}

function CheckSTDOUT()
{
	SerialSend('AT^SCFG="Userware/Stdout"\r').then( (result)=> {
		document.getElementById("STDOUTDropdownButton").innerHTML = result.split(",")[1].slice(1, -1).toUpperCase();
	})
}

function ServalRunBin()
{
	SerialSend('at^susrw=1,"' + device_path + '"\r')
}
function ServalStopBin()
{
	SerialSend('at^susrw=2,"' + device_path + '"\r')
}

function ServalDeleteFile()
{
	SerialSend('at^sfsa="remove","' + device_path.replace(/\/\//g,"/") + '"\r').then( (result)=> {
		ChangeDeviceDir(device_path.match(/(^.*)\//)[1]);
	})
}

function ServalDeleteFolder()
{
	SerialSend('at^sfsa="rmdir","' + device_path.replace(/\/\//g,"/") + '"\r').then( (result)=> {
		ChangeDeviceDir(device_path.match(/(^.*)\//)[1]);
	})
}

function CreateFolder(name)
{
	var fullpath = (device_path == "a:/") ? "a:/" + name : device_path + "/" + name
	SerialSend('at^sfsa="mkdir","' + fullpath + '"\r').then( (result)=> {
		ChangeDeviceDir(device_path);
		$('#CreateFolderModal').modal('hide');
	})
}

function TurnExtURCOn()
{
	SerialSend('AT+CMEE=2;+CEREG=4;^SIND=suspendAvailable,1;^SIND=suspendReady,1\r').then( (result)=> {
	})
}

function SetAPN()
{
	
	SerialSend('AT+COPS=2\r').then( (result)=> {
														
		})
																			
		setTimeout( function () {
		SerialSend('AT+CGDCONT=0,"IPV4V6","' + document.getElementById("UDPtestAPN").value + '"\r').then( (result)=> {
																
		})
																			
	}, 6000);
	
	setTimeout( function () {
		SerialSend('AT+COPS=0\r').then( (result)=> {
																	
		})
																			
	}, 6500);
	
}

function TurnExtURCOff()
{
	SerialSend('AT+CMEE=0;+CEREG=0^SIND=suspendAvailable,0;^SIND=suspendReady,0\r').then( (result)=> {
	})
}


function CreateDataPackage (smoni){

	
	var Delimiter = ",";
	//var Time = "21/02/10,11:38:29+04";
	var MAC = "111111";
	var DeviceID = "2222";
	var MessageType = "3";
	var ModemType = "44";
	//var SINR = "";
	//var RSSI = "";
	//var RSRP = "";
	//var RSRQ = "";
	var CELevel = "3";
	//var TXpower = "";
	var NetworkBearer = "NBIoT"
	//var CellID = "";
	var Payload = "test payload";
	var Battery = "3,6";

	
			si = smoni.split("\r")[1].split(",");
			console.log(smoni,si);
	
// example //
// ^SMONI: ACT,		EARFCN,	Band,	Deployment type,	PLMN code,	TAC,	Cell ID,	RSRP,	RSRQ,	RSSI,	TX power,	Connection state,	SNR //
// ^SMONI: NB-IoT,	3736,	8,		4,					46000,		3d45,	3632849,	-805,	-117,	-720,	210,		NOCONN,				83
// ^SMONI: NB-IoT,	6156,	20,		3,					21910,		9c40,	011c5b5,	-744,	-108,	-676,	-50,		NOCONN,				278
	
		var SINR = si[12];
		var RSSI = si[9];
		var RSRP = si[7];
		var RSRQ = si[8];
		var CellID = si[6];
		var TXpower = si[10];
		
		var Time = Date.now();
	//	Time.toUTCString();
		
	return Time+Delimiter+MAC+Delimiter+DeviceID+Delimiter+MessageType+Delimiter+ModemType+Delimiter+SINR+Delimiter+RSSI+Delimiter+RSRP+Delimiter+RSRQ+Delimiter+CELevel+Delimiter+NetworkBearer+Delimiter+CellID+Delimiter+TXpower+Delimiter+Payload+Delimiter+Battery;
//	return Time+MAC+DeviceID+MessageType+ModemType+SINR+RSSI+RSRP+RSRQ+CELevel+NetworkBearer+CellID+TXpower+Payload+Battery;

	//DataPackageLenght = DataPackageToBeSent.lenght;
	

}

function Resend_data()
{

	SerialSend('AT^SMONI\r').then( (result)=> {
		//console.log("SMONI=" + result,result.split("\n")[1] + result,result.split("\n")[1].length);
		si = CreateDataPackage(result);
		SerialSend('AT^SISW=0,' + si.length + ',4\r',true).then( (result)=> {
			console.log("si=",si);
			serialPort.write(si + '\r');
				setTimeout( function () {
					SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
						setTimeout( function () {
							SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
								setTimeout( function () {
									SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
										setTimeout( function () {
											SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
												setTimeout( function () {
													SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
								
													})
												}, 1000);
											})
										}, 1000);
									})
								}, 1000);
							})
						}, 1000);
					})
				}, 1000);
		}, 1000); // 1 sec after AT^SISW before AT^SISR
	})
}


function UDPtest()
{
	if ($('#toggle-UDPtest').prop('checked') == false) return;
	
	SerialSend('AT^SISC=0\r',true).then( (result)=> {
		SerialSend('AT+CGPADDR\r',true).then( (result)=> {
			SerialSend('at^scfg=tcp/withurcs,off\r',true).then( (result)=> {
				if (device_family == "EXS") cmd = "AT^SICA=1,1\r";
				else cmd = "AT^SICS=1,contype,GPRS0\r";
				SerialSend(cmd,true).then( (result)=> {
					if (device_family == "EXS") cmd = 'AT+CGDCONT=1,"IPV4V6","' + document.getElementById("UDPtestAPN").value + '"\r';
					else cmd = 'AT^SICS=1,apn,' + document.getElementById("UDPtestAPN").value +' \r';

					SerialSend(cmd,true).then( (result)=> {
						SerialSend('AT^SISS=0,srvtype,socket\r',true).then( (result)=> {
							SerialSend('AT^SISS=0,conid,1\r',true).then( (result)=> {
								SerialSend('AT^SISS=0,address,"sockudp://' + document.getElementById("IPaddr").value + ':' + document.getElementById("UDPport").value + '"\r',true).then( (result)=> {
									SerialSend('AT^SISO=0\r',true).then( (result)=> {
										setTimeout( function () {
											SerialSend('AT^SMONI\r',true).then( (result)=> {
												console.log("SMONI=" + result,result.split("\n")[1] + result,result.split("\n")[1].length);
												si = CreateDataPackage(result);
												SerialSend('AT^SISI=0\r',true).then( (result)=> {
													SerialSend('AT^SISW=0,' + si.length + '\r',true).then( (result)=> {
														console.log("si=",si);
														serialPort.write(si + '\r');
														
														setTimeout( function () {
															SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
																if (result.length > 50)	
																{
																	$('#toggle-UDPtest').bootstrapToggle('off');
																	return
																}
																setTimeout( function () {
																	SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
																		if (result.length > 50)	
																		{
																			$('#toggle-UDPtest').bootstrapToggle('off');
																			return
																		}
																		setTimeout( function () {
																			SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
																				if (result.length > 50)	
																				{
																					$('#toggle-UDPtest').bootstrapToggle('off');
																					return
																				}
																				setTimeout( function () {
																					SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
																						if (result.length > 50)	
																						{
																							$('#toggle-UDPtest').bootstrapToggle('off');
																							return
																						}
																						setTimeout( function () {
																							SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
																								if (result.length > 50)	
																								{
																									$('#toggle-UDPtest').bootstrapToggle('off');
																									return
																								}
																								setTimeout( function () {
																									SerialSend('AT^SISR=0,255\r',true).then( (result)=> {
																										if ($('#toggle-UDPtest').prop('checked') && ($('#RepeatSelect').children("option:selected").val()>0))
																										{
																											UDPtestTimer = setTimeout(UDPtest, $('#RepeatSelect').children("option:selected").val() )
																										}
																										else $('#toggle-UDPtest').bootstrapToggle('off');
																									})
																				
																								}, 1000);
																							})
																						}, 1000);
																					})
																				}, 1000);
																			})
																		}, 1000);
																	})
																}, 1000);
																
															})
														}, 1000); // 1 sec after AT^SISW before AT^SISI
													})						
												})						
											})
										}, 4000); // after AT^SISO
									})						
								})						
							})													
						})					
					})				
				})						
			})
		})
	})
}

function RefreshPSMeDRXSuspend()
{
	//if (!$('#collapseLPM').hasClass('show')) return;
	SerialSend('AT+CPSMS?\r',true).then( (result)=> { 
		//console.log(result.split("\n")[1], result.split("\n")[1].split(",")[0].replace( /^\D+/g, '') )
		
		if (result.split("\n")[1].split(",")[0].replace( /^\D+/g, '') == "0") 
			$('#toggle-PSMmode').bootstrapToggle('off');
		else
			$('#toggle-PSMmode').bootstrapToggle('on')
		document.getElementById('RequestedPeriodicRAU').value = result.split("\n")[1].split(",")[1].replace(/"/g,'');
		document.getElementById('RequestedGprsReadyTime').value = result.split("\n")[1].split(",")[2].replace(/"/g,'');
		document.getElementById('RequestedPeriodicTAU').value = result.split("\n")[1].split(",")[3].replace(/"/g,'');
		document.getElementById('RequestedActiveTime').value = result.split("\n")[1].split(",")[4].replace(/"/g,'');

		SerialSend('AT+CEDRXS?\r',true).then( (result)=> { 
		
			console.dir(result.split("\n")[1].split(","))
			
			document.getElementById('eDRXvalues').innerHTML = result.substring(2).replace('\r\nOK\r\n','');
						
			SerialSend('AT^SCFG="MEOpMode/PowerMgmt/Suspend"\r',true).then( (result)=> { 
				if (result.split("\n")[1].charAt(37) == "0") 
					$('#toggle-demo').bootstrapToggle('off');
				else
					$('#toggle-demo').bootstrapToggle('on')
			})
		})
	})
}

function ApplyPSM()
{
	
	var cmd = "AT+CPSMS="
	if ( $('#toggle-PSMmode').prop('checked') )
		cmd += "1,";
	else
		cmd += "0,";
	
	cmd += document.getElementById('RequestedPeriodicRAU').value+',';
	cmd += document.getElementById('RequestedGprsReadyTime').value+',';
	cmd += document.getElementById('RequestedPeriodicTAU').value+',';
	cmd += document.getElementById('RequestedActiveTime').value;
	
	SerialSend(cmd + '\r',true);
}

function ApplyeDRX()
{
	
	var cmd = "AT+CEDRXS="
	if ( $('#toggle-eDRXmode').prop('checked') )
	{
		cmd += "1," + $('#eDRXacttype').children("option:selected").val();
		cmd += ',' + $('#Requested_eDRX_value').val();
	}
	else
		cmd += "0," + $('#eDRXacttype').children("option:selected").val()
	
	SerialSend(cmd + '\r',true).then( (result)=> { 
		console.log(" - " + result)
		setTimeout(RefreshPSMeDRXSuspend(),100); 
	})
}

</script>
  </head>
  <body style="overflow-y: scroll;padding-top: 20px;" onload="if (localStorage.lastPort !== '') SerialOpen(localStorage.lastPort);">
  

	<nav class="navbar navbar-expand-sm navbar-dark bg-light fixed-top" style="margin-bottom:0px;">
		<ul class="navbar-nav">
			<li class="nav-item" style="padding-right:15px">
				<div class="dropdown" id="MainPortDropdown">
					<button class="btn btn-secondary btn-xs dropdown-toggle"  style="width:120px;" type="button" id="MainPortDropdownButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						COM port</button>
					<div class="dropdown-menu" aria-labelledby="MainPortDropdownButton" id="MainPortDropdownMenu"></div>
				</div>
			</li>
			<li class="nav-item" style="padding-right:15px;">
				<button class="btn btn-xs btn-secondary" style="visibility:hidden;" id="closeBtn" onClick="SerialClose();">Close</button>
			</li>
			<li class="nav-item" style="width:100px;padding-right:5px"><h6 style="line-height:1.5;"><small><span id="ati1"></span></small></h6></li>
			<li class="nav-item" style="width:300px;padding-right:5px"><h6 style="line-height:1.5;"><small><span id="ati2">no modem detected</span></small></h6></li>
		</ul>
	</nav>

	
	<div id="accordion" class="md-accordion accordion-blocks" style="padding-top:30px; visibility: hidden;">
	
		
		
		<div class="card">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseTerminal" aria-expanded="false" aria-controls="collapseTerminal">
					<h6 class="py-2">Terminal</h6>
				</a>
			</div>

			<div id="collapseTerminal" class="collapse" aria-labelledby="headingOne">
				<div class="card-body">
					<pre class="terminal" id="terminal1"><i id="pre1" style="color:grey;"></i><b class="cursor" id="cursor">B</b>
					</pre>

					<br>

					<div class="row">
						<div class="col-4">
								Logging &nbsp;<input id="toggle-Logging" type="checkbox" data-width="50" data-size="small"> 
						</div>
						<div class="col-8">
						      <div class="input-group">
								  <div class="custom-file custom-file form-control-sm">
									<input type="file" class="custom-file-input form-control form-control-sm" id="logfile"  onChange="localStorage.lastLogFile=document.getElementById('logfile').value;document.getElementById('logfilelable').innerHTML = document.getElementById('logfile').value;" >
									<label class="custom-file-label" for="logfile" id="logfilelable">Log file</label>
								  </div>
							  </div>
						</div>

					</div>
		
				<script>
				  $(function() {
					//console.log("logging:" ,localStorage.lastLogging);
					$('#toggle-Logging').bootstrapToggle(eval(localStorage.lastLogging) ? "on" : "off");
					
					$('#toggle-Logging').change(function() {
							localStorage.lastLogging = $(this).prop('checked');
							if ($(this).prop('checked'))
							{
								log2file(" - Logging started - ");						
							}
							else
							{
								log2file(" - Logging stopped - ");
							}
						})
					})
				</script>

				</div>
			</div>
		</div>
		
		<div class="card">
		<div class="card-header" id="CardManage">
			<a data-toggle="collapse" data-target="#collapseManage" aria-expanded="false" aria-controls="collapseManage" onClick="setTimeout(RefreshMidletStates,500);">
                <h6 class="py-2">Manage Java Midlets</h6>
            </a>
		</div>
		<div id="collapseManage" class="collapse" aria-labelledby="headingTwo">
		  <div class="card-body">
				<div class="tab-pane" id="midlets_" style="padding:10px;">
				<table class="table table-sm table-striped">
				<thead>
					<tr>
					  <th>Name</th> <th>Vendor</th> <th>ver</th> <th>size</th> <th>Controls</th> <th><a href="javascript:RefreshMidletStates();"><i class='fa fa-refresh'></i></a></th>
					</tr>
				</thead>
				<tbody id="midletsList">
				</tbody>
				</table>
				</div>

		  </div>
		</div>
		</div>

		<div class="card">
		<div class="card-header" id="CardSTDOUT">
			<a data-toggle="collapse" data-target="#collapseSTDOUT" aria-expanded="false" aria-controls="collapseSTDOUT" onClick="CheckSTDOUT();">
                <h6 class="py-2">Java Midlets STDOUT</h6>
            </a>
		</div>
		<div id="collapseSTDOUT" class="collapse" aria-labelledby="headingTwo">
		  <div class="card-body">
			  <div class="row">
				<div class="col-sm-1"></div>
				<div class="col-sm-2">
					<label for="STDOUT">STDOUT</label>
				</div>
				<div class="col-sm-2">
					<div class="dropdown show" id="STDOUTDropdown">
						<button class="btn btn-secondary btn-xs dropdown-toggle"  style="" type="button" id="STDOUTDropdownButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							port</button>
						<div class="dropdown-menu" aria-labelledby="STDOUTDropdownButton" id="STDOUTDropdownMenu">
							<a class="dropdown-item" href="javascript:SetSTDOUT('NULL');">NULL</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('ASC0');">ASC0</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('ASC1');">ASC1</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('USB' );">USB</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('USB1');">USB1</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('USB2');">USB2</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('USB3');">USB3</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('USB4');">USB4</a>
							<a class="dropdown-item" href="javascript:SetSTDOUT('USB5');">USB5</a>
						</div>
					</div>
				</div>
				<div class="col-sm-1"></div>

				<div class="col-sm-2">
					<label for="MPORT">monitor</label>
				</div>
				<div class="col-sm-2">
					<div class="form-group">
						<div class="dropdown" id="MPORTDropdown">
							<button class="btn btn-xs btn-secondary dropdown-toggle"  style="" type="button" id="MPORTDropdownButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								None</button>
							<div class="dropdown-menu" aria-labelledby="MPORTDropdownButton" id="MPORTDropdownMenu"></div>
						</div>
					</div>
				</div>

			  </div>
			  
   			<pre class="terminal" id="terminal2"><span id="pre2" style="color:grey;"></span><b class="cursor" id="cursor">B</b></pre>

		  </div>
		</div>
		</div>

		<div class="card">
		<div class="card-header" id="CardUpload">
			<a data-toggle="collapse" data-target="#collapseUpload" aria-expanded="false" aria-controls="collapseUpload">
                <h6 class="py-2">Upload Java Midlet</h6>
            </a>
		</div>
		<div id="collapseUpload" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
		  <div class="card-body">
		  <div class="row">
			  <div class="col-sm-6">
				<div class="card">
				  <div class="card-body">
					<h5 class="card-title" id="jadFile">no file selected</h5>
						<div class="form-check">
						  <input class="form-check-input" type="checkbox" value="" id="watchcb" style="margin-top:7px;">
						  <label class="form-check-label" for="watchcb">
							Trigger upload when file changes on PC
						  </label>
						</div>
					<a href="#" class="btn btn-primary btn-sm" style="margin-top:10px;">
						<label style="margin-bottom:0px;" class="btn-xs">Select file to upload&hellip; <input id="FileInput" type="file" style="display: none;"></label>
					</a>
				  </div>
				</div>
			  </div>
			  <div class="col-sm-6">
				<div class="card">
				  <div class="card-body">
					<h5 class="card-title">If .jad selected - </h5>
						<table >
							<tr>
								<td style="padding-left:21px;">Upload .jad</td>
								<td><i style="visibility:hidden;" id="step1" class='fa fa-coffee'></i></td>
							</tr>
							<tr>
								<td>
									<div class="form-check">
									  <input class="form-check-input" type="checkbox" checked value="" id="step2cb" style="margin-top:7px;">
									  <label class="form-check-label" for="step2cb">Upload .jar as well</label>
									</div>
								</td>
								<td><i style="visibility:hidden;" id="step2" class='fa fa-coffee'></i></td>
							</tr>
							<tr>
								<td>
									<div class="form-check">
									  <input class="form-check-input" type="checkbox" checked value="" id="step3cb" style="margin-top:7px;">
									  <label class="form-check-label" for="step3cb">Stop old midlet</label>
									</div>
								</td>
								<td><i style="visibility:hidden;" id="step3" class='fa fa-coffee'></i></td>
							</tr>
							<tr>
								<td>
									<div class="form-check">
									  <input class="form-check-input" type="checkbox" checked value="" id="step4cb" style="margin-top:7px;">
									  <label class="form-check-label" for="step4cb">Install new midlet</label>
									</div>
								</td>
								<td><i style="visibility:hidden;" id="step4" class='fa fa-coffee'></i></td>
							</tr>
							<tr>
								<td>
									<div class="form-check">
									  <input class="form-check-input" type="checkbox" checked value="" id="step5cb" style="margin-top:7px;">
									  <label class="form-check-label" for="step5cb">Run</label>
									</div>
								</td>
								<td><i style="visibility:hidden;" id="step5" class='fa fa-coffee'></i></td>
							</tr>
							<tr>
								<td>
									<div class="form-check">
									  <input class="form-check-input" type="checkbox" checked value="" id="step6cb" style="margin-top:7px;">
									  <label class="form-check-label" for="step6cb">Beep</label>
									</div>
								</td>
								<td><i style="visibility:hidden;" id="step6"  class='fa fa-coffee'></i></td>
							</tr>
					</table>
				  </div>
				</div> 
			  </div>
			</div>
			</div>
		</div> <!-- <div id="collapseUpload" -->
		
		</div> <!-- card -->
		
		<div class="card" id="FileExplorerCard">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseFileExplorer" aria-expanded="false" aria-controls="collapseFileExplorer" onclick='setTimeout(ChangeDeviceDir("a:/"),100);'>
					<h6 class="py-2">File Explorer</h6>
				</a>
			</div>

		<div id="collapseFileExplorer" class="collapse" aria-labelledby="headingOne">
		  <div class="card-body">

			<div class="nav-container" style="position:relative;">
				<ol class="breadcrumb py-1" id="breadcrumb" >
				</ol>
				<div class="btn-group" role="group" aria-label="Basic example" style="position:absolute;right:1rem;top:50%;transform:translateY(-50%);">
				  <button id="fe_edit"  class="btn btn-default btn-sm fe_btn" title="Open/Edit"><i class="far fa-edit"></i></button>
				  <button id="fe_save"  class="btn btn-default btn-sm fe_btn" title="Save"><i class="far fa-save"></i></button>
				  <button id="fe_run"  class="btn btn-default btn-sm fe_btn"  title="Run" onClick="javascript:ServalRunBin();"><i class="fas fa-play"></i></button>
				  <button id="fe_stop"  class="btn btn-default btn-sm fe_btn" title="Stop" onClick="javascript:ServalStopBin();"><i class="fas fa-stop"></i></button>
				  <button id="fe_upload"  class="btn btn-default btn-sm fe_btn" title="Upload file" data-toggle="modal" data-target="#UploadFileModal"><i class="fas fa-file-upload"></i></button>
				  <button id="fe_create"  class="btn btn-default btn-sm fe_btn" title="Create Folder"  data-toggle="modal" data-target="#CreateFolderModal"><i class="fas fa-folder-plus"></i></button>
				  <button id="fe_rmfile" class="btn btn-default btn-sm fe_btn" data-toggle="tooltip" data-placement="top" title="Remove File" onClick="javascript:ServalDeleteFile();"><i class="fas fa-trash"></i></button>
				  <button id="fe_rmdir" class="btn btn-default btn-sm fe_btn" data-toggle="tooltip" data-placement="top" title="Remove Folder" onClick="javascript:ServalDeleteFolder();"><i class="fas fa-trash"></i></button>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-4" style="max-height:210px;overflow-y: auto; padding-right: 15px;">
					<ul class="list-group" id="filelist"></ul>
				</div>
				<div class="col-sm-8" style=""><textarea style="font-family:monospace" class="form-control" rows="10" id="contents"></textarea></div>
			</div>

		  </div>
		</div>
		</div>

		

		<div class="card">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseNetwork" aria-expanded="false" aria-controls="collapseNetwork" onclick="setTimeout(NetworkRefresh,500);">
					<h6 class="py-2">Configuration & Network registration status</h6>
				</a>
			</div>

		<div id="collapseNetwork" class="collapse" aria-labelledby="headingOne">
		  <div class="card-body">

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+CPIN</span>
			  </div>
			  <input id="CPIN" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+CIMI</span>
			  </div>
			  <input id="CIMI" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+CGSN</span>
			  </div>
			  <input id="CGSN" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+CEREG</span>
			  </div>
			  <input id="CEREG" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">^SMONI</span>
			  </div>
			  <input id="SMONI" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+COPS</span>
			  </div>
			  <input id="COPS" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+CGPADDR</span>
			  </div>
			  <input id="CGPADDR" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+CPSMS</span>
			  </div>
			  <input id="CPSMS" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
			  <div class="input-group-prepend">
				<span style="width:80px;" class="input-group-text" id="basic-addon1">+CEDRXRDP</span>
			  </div>
			  <input id="CEDRXRDP" type="text" class="form-control" disabled>
			</div>

			<div class="input-group mb-2 input-group-sm">
				<span  id="CGDCONT" class="input-group-text" style="white-space: pre;text-align: left;width: 100%; font-size: 14px;">+CGDCONT:</span>
			</div>

			<div class="input-group mb-2 input-group-sm">
				<span  id="SCFG" class="input-group-text" style="white-space: pre;text-align: left;width: 100%; font-size: 14px;">^SCFG:</span>
			</div>

		  </div>
		</div>
		</div>
		
		<div class="card">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseUDP" aria-expanded="false" aria-controls="collapseUDP">
					<h6 class="py-2">UDP test</h6>
				</a>
			</div>
			<div id="collapseUDP" class="collapse" aria-labelledby="headingOne">
			  <div class="card-body">
			  			  
				<div class="input-group input-group-sm mb-2">
				  <div class="input-group-prepend">
					<span class="input-group-text" id="inputGroup-sizing-sm">APN</span>
				  </div>
				  <input id="UDPtestAPN" value="IOT.HT.HR" type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm">
				&nbsp;
			
		
				</div>
				<div class="input-group input-group-sm mb-2">
				  <div class="input-group-prepend">
					<span class="input-group-text" id="inputGroup-sizing-sm">IP addr</span>
				  </div>
				  <input id="IPaddr" value="78.47.86.194" type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm">
				  &nbsp;
				  <div class="input-group-prepend">
					<span class="input-group-text" id="inputGroup-sizing-sm">UDP port</span>
				  </div>
				  <input id="UDPport" value="7" type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm">
				  
				</div>
				<div class="row">
					<div class="col-12 mx-auto">
						<div class="text-center">
								<button class="btn btn-secondary btn-sm" type="button" onClick="Resend_data();">Resend data + RAI</button>
								<input id="toggle-UDPtest" type="checkbox" data-width="100" data-size="small">
						</div>
					</div>
				</div>
		
				<script>
				  $(function() {
					$('#toggle-UDPtest').bootstrapToggle({
					  on: 'STARTED',
					  off: 'STOPPED'
					});
					
					$('#toggle-UDPtest').change(function() {
						if ($(this).prop('checked'))
						{
							//start UDP test
							UDPtest();
												
						}
						else
						{
							//SerialSend("AT^SISI=0\r");
							if (typeof variable !== 'undefined') {
								clearTimout(UDPtestTimer);
							}
						}
						})
					})
				</script>
				
			</div>
			</div>
		</div>
		
		<div class="card" id="ATT3Gsunset">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseATT3Gsunset" aria-expanded="false" aria-controls="collapseATT3Gsunset"  onclick="setTimeout(RefreshCentric(),100);" >
					<h6 class="py-2">AT&T 3G network sunset - ELS61-USA update</h6>
				</a>
			</div>
			<div id="collapseATT3Gsunset" class="collapse" aria-labelledby="headingOne">
			  <div class="card-body">
			  			  
				<div>
				<div class="row">
					<div class="col-12 mx-auto">
						<div class="text-center">
								<input id="toggle-ATT3Gsusetfix" type="checkbox" data-width="100" data-size="small">
								&nbsp;&nbsp;&nbsp;&nbsp;
								Status
								<button id="centricbtn" class="btn btn-secondary btn-sm" type="button" >Voice centric</button>

						</div>
					</div>
				</div>
		
				<script>
					function RefreshCentric()
					{
						SerialSend('AT+CEMODE?\r',true).then( (result)=> { 
							if (result.match(/\d+/g) == "0") $("#centricbtn").addClass("btn-success").removeClass("btn-warning").html("Data Centric");
							else $("#centricbtn").removeClass("btn-success").addClass("btn-warning").html("Voice Centric");
						})
					}

					$(function() {
						$('#toggle-ATT3Gsusetfix').bootstrapToggle({
						  on: 'Processing',
						  off: 'Fix'
						});
						
						$('#toggle-ATT3Gsusetfix').change(function() {
						if ($(this).prop('checked'))
						{
						
							UploadBin(nwDir + "\\app\\ATT3Gsunset\\atonsysstart.cfg").then ( ()=> {
								Upload(nwDir + "\\app\\ATT3Gsunset\\atonsysstart.jad").then ( ()=> {
								$("#centricbtn").addClass("btn-success").removeClass("btn-warning").html("Data Centric");
								$('#toggle-ATT3Gsusetfix').bootstrapToggle('off')
								SerialSend("AT+CFUN=1,1\r\n");
								})
							})
												
						}
						
						})
					})
				</script>
				
			</div>
			</div>
		</div>
		
		<div class="card" id="CardLPM">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseLPM" aria-expanded="false" aria-controls="collapseLPM" onclick="setTimeout(RefreshPSMeDRXSuspend(),100);">
					<h6 class="py-2">PSM, eDRX, suspend modes</h6>
				</a>
			</div>
			<div id="collapseLPM" class="collapse" aria-labelledby="headingOne">
			  <div class="card-body">
			  
			  <h5 class="card-title">PSM</h5>
				
					<div class="container">
					   <div class="row">

					<div class="input-group input-group-sm mb-2">

					<div class="input-group-prepend">
						<span class="input-group-text" id="inputGroup-sizing-sm1">Mode</span>
					</div>
				  	<input id="toggle-PSMmode" type="checkbox" data-width="100" data-size="small" aria-describedby="inputGroup-sizing-sm1" data-on="Enabled" data-off="Disabled" data-style="quick">
					<br>
					<script>
					  $(function() {
						$('#toggle-PSMmode').bootstrapToggle();
						})
					</script>
				  </div>
  				  
					<div class="input-group input-group-sm mb-2">
						<div class="input-group-prepend">
							<span class="input-group-text" id="RequestedPeriodicRAU-sm">RequestedPeriodicRAU</span>
						</div>
						<input id="RequestedPeriodicRAU" value="" type="text" class="form-control" aria-label="Small" aria-describedby="RequestedPeriodicRAU-sm">
						&nbsp;
						<div class="input-group-prepend">
							<span class="input-group-text" id="RequestedGprsReadyTime-sm">RequestedGprsReadyTime</span>
						</div>
						<input id="RequestedGprsReadyTime" value="" type="text" class="form-control" aria-label="Small" aria-describedby="RequestedGprsReadyTime-sm">
					</div>

					<div class="input-group input-group-sm mb-2">
						<div class="input-group-prepend">
							<span class="input-group-text" id="RequestedPeriodicTAU-sm">RequestedPeriodicTAU</span>
						</div>
						<input id="RequestedPeriodicTAU" value="" type="text" class="form-control" aria-label="Small" aria-describedby="RequestedPeriodicTAU-sm">
						&nbsp;
						<div class="input-group-prepend">
							<span class="input-group-text" id="RequestedActiveTime-sm">RequestedActiveTime</span>
						</div>
						<input id="RequestedActiveTime" value="" type="text" class="form-control" aria-label="Small" aria-describedby="RequestedActiveTime-sm">
					</div>
				  
						</div>
					</div>
					<a href="#" class="btn btn-primary btn-sm" onClick="ApplyPSM();">Apply</a>
				

					<hr>
					<h5 class="card-title">eDRX</h5>
				

					<div class="container">
					   <div class="row">
						 <div class="col-sm-8" style="padding-left: 0px;">
						   <div class="input-group input-group-sm mb-2">

							<div class="input-group-prepend">
								<span class="input-group-text" id="toggle-eDRXmode-sm">Mode</span>
							</div>
							<input id="toggle-eDRXmode" type="checkbox" data-width="100" data-size="small" aria-describedby="toggle-eDRXmode-sm" data-on="Enabled" data-off="Disabled" data-style="quick">
							<br>
							<script>
							  $(function() {
								$('#toggle-eDRXmode').bootstrapToggle();
								})
							</script>
						  
						   </div>
						   <div class="input-group input-group-sm mb-2">

						  
						  <div class="input-group-prepend">
							<label class="input-group-text" for="eDRXacttype">Type of access tech</label>
						  </div>
						  <select class="custom-select" id="eDRXacttype">
							<option value="0">using eDRX.</option>
							<option value="2">GSM</option>
							<option selected value="4">CatM</option>
							<option value="5">NB-IoT</option>
						  </select>
						  </div>
						  
						  
							<div class="input-group input-group-sm mb-2">
								<div class="input-group-prepend">
									<span class="input-group-text" id="Requested_eDRX_value-sm">Requested_eDRX_value</span>
								</div>
								<input id="Requested_eDRX_value" value="" type="text" class="form-control" aria-label="Small" aria-describedby="Requested_eDRX_value-sm">
							</div>
						 </div>
						 <!-- /.col-sm-6 -->
						 <div class="col-sm-4" style="padding-right: 0px;">
						   <span  id="eDRXvalues" class="input-group-text" style="white-space: pre;text-align: left;width: 100%; font-size: 14px;">OK</span>
						 </div>
						 <!-- /.col-sm-6 -->
					   </div>
					   <!-- /.row -->
					</div>
					<!-- /.container -->					
					
					<a href="#" class="btn btn-primary btn-sm" onClick="ApplyeDRX();">Apply</a>
					<hr>
					
					<h5 class="card-title">Suspend mode</h5>
					
					<input id="toggle-suspend" type="checkbox" data-width="100" data-size="small" aria-describedby="toggle-suspend-sm" data-on="Enabled" data-off="Disabled" data-style="quick">
					<br>
			
					<script>
					  $(function() {
						$('#toggle-suspend').bootstrapToggle();
						
						$('#toggle-suspend').change(function() {
													
						if ($(this).prop('checked'))
						{
								SerialSend('AT^SCFG="MEOpMode/PowerMgmt/Suspend","1"\r',true)
						}
						else
						{
								SerialSend('AT^SCFG="MEOpMode/PowerMgmt/Suspend","0"\r',true)						}
						})
					  })
					</script>

					
			</div>
		</div>
		 
		<div class="card">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseSXRAT" aria-expanded="false" aria-controls="collapseSXRAT" onclick="/*setTimeout(URCRefresh,500);*/">
					<h6 class="py-2">Radio Access Technology selection</h6>
				</a>
			</div>
			<div id="collapseSXRAT" class="collapse" aria-labelledby="headingOne">
			  <div class="card-body">
				
				<div class="container">
				<div class="row justify-content-center" style="text-align: center;">
					<div class="col col-sm-6"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('at^sxrat=12,8,7\r',true);">Automatic</button></div>
				</div>
				<div class="row justify-content-center" style="padding-top:20px">
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('at^sxrat=7\r',true);">CatM only</button></div>
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('at^sxrat=8\r',true);">NB-IoT only</button></div>
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('at^sxrat=0\r',true);">2G only</button></div>
				</div>
				</div>
				

			  </div>
			</div>
		</div>
		 
		<div class="card">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapseURC" aria-expanded="false" aria-controls="collapseURC" onclick="/*setTimeout(URCRefresh,500);*/">
					<h6 class="py-2">Configure the EXTENDED URC reporting</h6>
				</a>
			</div>
			<div id="collapseURC" class="collapse" aria-labelledby="headingOne">
			  <div class="card-body">
				
				<div class="container">
				<div class="row justify-content-center">
					<div class="col col-sm-2"><button class="btn btn-primary btn-xs" type="button" onClick="TurnExtURCOn();">On</button></div>
					<div class="col col-sm-2"><button class="btn btn-secondary btn-xs" type="button" onClick="TurnExtURCOff();">Off</button></div>
				</div>
				</div>
				

			  </div>
			</div>
		</div>
		 
				<div class="card">
			<div class="card-header" id="headingOne" role="tab">
				<a data-toggle="collapse" data-target="#collapsePowerOFFthemodem" aria-expanded="false" aria-controls="collapsePowerOFFthemodem" onclick="/*setTimeout(URCRefresh,500);*/">
					<h6 class="py-2">Manage Modem: Power OFF, set APN, more...</h6>
				</a>
			</div>
			<div id="collapsePowerOFFthemodem" class="collapse" aria-labelledby="headingOne">
			  <div class="card-body">
				
				<div class="container">
				<div class="row justify-content-center">
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('AT^SMSO\r',true);">Power OFF</button></div>
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SetAPN();">Change APN</button></div>
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('AT^SMONI\r',true);">Network Status</button></div>
				</div>
				<div class="row justify-content-center">
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('AT^SISO?\r',true);">Socket Status</button></div>
					<div class="col col-sm-3"><button class="btn btn-secondary btn-sm" type="button" onClick="SerialSend('AT^SISC=0\r',true);">Manually Close Socket</button></div>
				</div>
				</div>
				

			  </div>
			</div>
		</div>
		
		
		
		
	</div>

<!-- UploadFileModal -->
<div class="modal fade" id="UploadFileModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Upload File to module</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
	  <div class="modal-body">
      <div class="input-group">
		  <div class="custom-file">
			<input type="file" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01">
			<label class="custom-file-label" for="inputGroupFile01">Choose file</label>
		  </div>
	  </div>
		<div class="form-check" style="margin-top:20px;">
		  <input class="form-check-input" type="checkbox" value="" id="watchbin" style="margin-top:7px;">
		  <label class="form-check-label" for="watchbin">
			Trigger upload when file changes on PC
		  </label>
		</div>
	  
	  
	  </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary btn-sm" onClick="UploadBin(document.getElementById('inputGroupFile01').value);">Upload</button>
      </div>
    </div>
  </div>
</div>
<!-- CreateFolderModal -->
<div class="modal fade" id="CreateFolderModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Create Folder</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
	  <div class="modal-body">
      <div class="input-group">
		  <div class="custom-file">
			<input class="form-control" type="text" id="CreateFolderName" placeholder="Folder name">

		  </div>
	  </div>
	  
	  </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary btn-sm" onClick="CreateFolder(document.getElementById('CreateFolderName').value);">OK</button>
      </div>
    </div>
  </div>
</div>




</body>
</html>


